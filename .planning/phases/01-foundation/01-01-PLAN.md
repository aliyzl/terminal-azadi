---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - go.mod
  - go.sum
  - .gitignore
  - cmd/azad/main.go
  - internal/cli/root.go
  - internal/cli/connect.go
  - internal/cli/servers.go
  - internal/cli/config_cmd.go
autonomous: true
requirements:
  - FNDN-01
  - FNDN-03

must_haves:
  truths:
    - "go build ./cmd/azad compiles without errors"
    - "Running azad --help shows connect, servers, and config subcommands with descriptions"
    - "Running azad --cleanup and azad --reset-terminal flags are recognized (stubs that print not-yet-implemented)"
    - "xray-core is importable as a Go library (blank import compiles)"
  artifacts:
    - path: "go.mod"
      provides: "Go module definition with xray-core, cobra, koanf dependencies"
      contains: "github.com/xtls/xray-core"
    - path: "cmd/azad/main.go"
      provides: "Application entry point"
      min_lines: 10
    - path: "internal/cli/root.go"
      provides: "Cobra root command with --cleanup and --reset-terminal flags"
      exports: ["NewRootCmd"]
    - path: "internal/cli/connect.go"
      provides: "Connect subcommand stub"
      min_lines: 10
    - path: "internal/cli/servers.go"
      provides: "Servers subcommand stub"
      min_lines: 10
    - path: "internal/cli/config_cmd.go"
      provides: "Config subcommand stub"
      min_lines: 10
  key_links:
    - from: "cmd/azad/main.go"
      to: "internal/cli/root.go"
      via: "cli.NewRootCmd() call"
      pattern: "cli\\.NewRootCmd"
    - from: "internal/cli/root.go"
      to: "internal/cli/connect.go"
      via: "rootCmd.AddCommand(newConnectCmd())"
      pattern: "AddCommand.*newConnectCmd"
---

<objective>
Initialize the Go project with xray-core as a library dependency and create the cobra CLI skeleton with all Phase 1 subcommands and root flags.

Purpose: Establish the compilable Go binary that all subsequent phases build upon. Without a working module and CLI routing, nothing else can be wired.
Output: A `go build`-able binary that responds to `azad --help`, `azad connect`, `azad servers`, `azad config`, `azad --cleanup`, and `azad --reset-terminal`.
</objective>

<execution_context>
@/Users/lee/.claude/get-shit-done/workflows/execute-plan.md
@/Users/lee/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Go module with dependencies and project structure</name>
  <files>
    go.mod
    go.sum
    .gitignore
    cmd/azad/main.go
  </files>
  <action>
1. Run `go mod init github.com/leejooy96/azad` (use project owner's GitHub namespace -- check git remote or use a reasonable default).
2. Add dependencies:
   - `go get github.com/xtls/xray-core@v1.260206.0`
   - `go get github.com/spf13/cobra@v1.9.1`
   - `go get github.com/knadh/koanf/v2@latest`
   - `go get github.com/knadh/koanf/parsers/yaml@latest`
   - `go get github.com/knadh/koanf/providers/file@latest`
   - `go get github.com/knadh/koanf/providers/confmap@latest`
   - `go get github.com/knadh/koanf/providers/structs@latest`
   - `go get golang.org/x/term@latest`
3. Create `.gitignore` with entries for: `/azad` (compiled binary), `*.exe`, `.DS_Store`, `/data/`, `*.dat` (geo files), `*.log`.
4. Create `cmd/azad/main.go`:
   - Package `main`
   - Import `internal/cli` package and `github.com/xtls/xray-core/core` (blank import for validation) and `_ "github.com/xtls/xray-core/main/distro/all"` (side-effect registration)
   - Define `var version = "dev"` for build-time injection
   - Call `cli.NewRootCmd(version)` and `cmd.Execute()`
   - On execute error, `os.Exit(1)`
5. Create directory structure: `mkdir -p cmd/azad internal/cli internal/config internal/lifecycle`
6. Run `go mod tidy` to resolve all transitive dependencies.
7. Verify `go build ./cmd/azad` compiles (will fail until Task 2 creates cli package -- that is fine, both tasks run sequentially within this plan).

NOTE: Go 1.26 is required by xray-core. If `go version` shows older, the build will fail. Document this in the summary if encountered.
  </action>
  <verify>
    <automated>cd /Users/lee/vless-terminal && go mod tidy 2>&1 | head -20 && test -f go.mod && grep "xray-core" go.mod</automated>
    <manual>go.mod exists and lists xray-core, cobra, koanf as dependencies</manual>
  </verify>
  <done>Go module initialized with go.mod listing xray-core v1.260206.0, cobra v1.9, koanf v2. Directory structure cmd/azad/ and internal/{cli,config,lifecycle}/ exists. .gitignore covers binary and data artifacts.</done>
</task>

<task type="auto">
  <name>Task 2: Create cobra CLI skeleton with subcommands and root flags</name>
  <files>
    internal/cli/root.go
    internal/cli/connect.go
    internal/cli/servers.go
    internal/cli/config_cmd.go
  </files>
  <action>
1. Create `internal/cli/root.go`:
   - Package `cli`
   - Export `func NewRootCmd(version string) *cobra.Command`
   - Root command: Use="azad", Short="Beautiful terminal VPN client", Long="Azad â€” One command to connect to the fastest VPN server through a stunning terminal interface"
   - Add `--version` flag via `rootCmd.Version = version`
   - Add persistent bool flags: `--cleanup` ("Remove dirty proxy state from a previous crash") and `--reset-terminal` ("Restore terminal to usable state")
   - In `PersistentPreRunE`: if cleanup flag set, print "cleanup: not yet implemented" and `os.Exit(0)`. If reset-terminal flag set, print "reset-terminal: not yet implemented" and `os.Exit(0)`. These are stubs for Plan 02.
   - Register subcommands via `rootCmd.AddCommand(newConnectCmd(), newServersCmd(), newConfigCmd())`
   - Return rootCmd

2. Create `internal/cli/connect.go`:
   - Package `cli`
   - Unexported `func newConnectCmd() *cobra.Command`
   - Use="connect [server]", Short="Connect to a VPN server", Long explains this connects via Xray-core proxy
   - RunE prints "connect: not yet implemented" (stub for Phase 3)

3. Create `internal/cli/servers.go`:
   - Package `cli`
   - Unexported `func newServersCmd() *cobra.Command`
   - Use="servers", Short="Manage VPN servers"
   - RunE prints "servers: not yet implemented" (stub for Phase 4)

4. Create `internal/cli/config_cmd.go` (not `config.go` to avoid collision with future config package import):
   - Package `cli`
   - Unexported `func newConfigCmd() *cobra.Command`
   - Use="config", Short="View and modify configuration"
   - RunE prints "config: not yet implemented" (stub -- Plan 02 will wire real config logic)

5. After all files created, run `go build -o azad ./cmd/azad` to verify compilation.
6. Run `./azad --help` and verify output shows all three subcommands.
7. Run `./azad --version` and verify it shows "azad version dev".
8. Run `./azad --cleanup` and `./azad --reset-terminal` to verify flags are recognized.

IMPORTANT: Use `fmt.Println` for stub messages, not `log.Println`. Keep imports minimal. Do NOT use `init()` functions for command registration -- use explicit AddCommand calls per project conventions from RESEARCH.md.
  </action>
  <verify>
    <automated>cd /Users/lee/vless-terminal && go build -o azad ./cmd/azad && ./azad --help 2>&1 | grep -q "connect" && ./azad --help 2>&1 | grep -q "servers" && ./azad --help 2>&1 | grep -q "config" && echo "PASS: all subcommands present"</automated>
    <manual>Run ./azad --help and confirm connect, servers, config subcommands are listed with descriptions</manual>
  </verify>
  <done>Binary compiles. `azad --help` lists connect, servers, config subcommands. `azad --cleanup` and `azad --reset-terminal` are recognized flags. `azad --version` prints version string.</done>
</task>

</tasks>

<verification>
1. `go build -o azad ./cmd/azad` succeeds with exit code 0
2. `./azad --help` output includes "connect", "servers", "config" subcommands
3. `./azad --version` outputs version string
4. `./azad --cleanup` prints stub message and exits cleanly
5. `./azad --reset-terminal` prints stub message and exits cleanly
6. `./azad connect` prints stub message
7. `./azad servers` prints stub message
8. `go vet ./...` passes with no errors
</verification>

<success_criteria>
- Go binary compiles from `cmd/azad/main.go` with xray-core as library dependency
- CLI routing works: 3 subcommands + 2 root flags all recognized
- Project follows `cmd/` + `internal/` Go layout convention
- No `init()` functions used for command registration
- Clean `go vet ./...` output
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
